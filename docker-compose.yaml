version: '2'

services:

  git:
    image: 'gogs/gogs'
    volumes:
      - 'git-data:/data'
    links:
      - 'db'
    depends_on:
      - 'db'
    environment:
      - VIRTUAL_HOST=git.callisto.local

  db:
    image: 'postgres'
    env_file: db.env
    volumes:
      - 'db-data:/var/lib/postgresql/data'
    
  proxy:
    image: 'jwilder/nginx-proxy'
    ports:
      - 80:80
    volumes:
      - '/var/run/docker.sock:/tmp/docker.sock:ro'
    environment:
      - DEFAULT_HOST=callisto.local

volumes:
  git-data:
  db-data:
