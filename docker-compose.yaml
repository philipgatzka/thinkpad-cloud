version: '2'

services:

  git:
    image: 'gogs/gogs'
    volumes:
      - git-data:/data
    links:
      - 'db'
    depends_on:
      - 'db'
    env_file: git.env

  mopidy:
    image: 'wernight/mopidy'
    volumes:
      - ./mopidy/media:/var/lib/mopidy/media:ro
      - ./mopidy/local:/var/lib/mopidy/local
      - ./mopidy.cmd.sh:/mopidy.cmd.sh
    command: /mopidy.cmd.sh
    env_file: mopidy.env

  db:
    image: 'postgres'
    env_file: db.env
    volumes:
      - db-data:/var/lib/postgresql/data
    
  proxy:
    image: jwilder/nginx-proxy
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - ./certs:/etc/nginx/certs
    depends_on:
      - 'git'
      - 'mopidy'

volumes:
  git-data:
  db-data:
